<!DOCTYPE html><!-- Last Published: Sun Dec 22 2024 15:37:51 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="www.televault.io" data-wf-page="670ce5d6458eb6b1821f9d80" data-wf-site="66e67a4cc40e1bbd3ff60b7c"><head><meta charset="utf-8"/><title>Redeem</title><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/css/televaultxyz.webflow.503272f0c.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com" rel="preconnect"/><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous"/><script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Inter:regular,500,600,700,800"]  }});</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/66e685047c6fe1d7d02adb04_logo-32.png" rel="shortcut icon" type="image/x-icon"/><link href="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/66e6850a7c6fe1d7d02ade02_logo-256.png" rel="apple-touch-icon"/><!-- Please keep this css code to improve the font quality-->
<style>
  * {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
</style></head><body class="body"><div class="page-wrapper"><div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav"><div class="container w-container"><a href="redeem.html#" class="brand w-nav-brand"><img src="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/66e7ededea3a5299026b6d21_Televault%20Full%20Logo%20White%20Small.png" loading="lazy" alt="Televault logo" class="image"/></a><nav role="navigation" class="w-nav-menu"><a href="index.html" class="nav-link w-nav-link">Bridge</a><a href="redeem.html#" class="nav-link-2 w-nav-link">Redeem</a><a href="redeem.html#" class="nav-link-3 w-nav-link">Swap</a><a id="btn-connect" href="javascript:void(0)" class="button-nav w-button">Connect Wallet</a></nav><div class="w-nav-button"><div class="w-icon-nav-menu"></div></div></div></div><div class="global-styles w-embed"><style>

/* Snippet gets rid of top margin on first element in any rich text*/
.w-richtext>:first-child {
	margin-top: 0;
}

/* Snippet gets rid of bottom margin on last element in any rich text*/
.w-richtext>:last-child, .w-richtext ol li:last-child, .w-richtext ul li:last-child {
	margin-bottom: 0;
}

/* Snippet prevents all click and hover interaction with an element */
.clickable-off {
	pointer-events: none;
}

/* Snippet enables all click and hover interaction with an element */
.clickable-on{
  pointer-events: auto;
}

/* Snippet enables you to add class of div-square which creates and maintains a 1:1 dimension of a div.*/
.div-square::after {
	content: "";
	display: block;
	padding-bottom: 100%;
}

/*Hide focus outline for main content element*/
main:focus-visible {
	outline: -webkit-focus-ring-color auto 0px;
}

/* Make sure containers never lose their center alignment*/
.container-medium, .container-small, .container-large {
	margin-right: auto !important;
	margin-left: auto !important;
}

/*Reset buttons, and links styles*/
a {
	color: inherit;
	text-decoration: inherit;
	font-size: inherit;
}

/*Apply "..." after 3 lines of text */
.text-style-3lines {
	display: -webkit-box;
	overflow: hidden;
	-webkit-line-clamp: 3;
	-webkit-box-orient: vertical;
}

/*Apply "..." after 2 lines of text */
.text-style-2lines {
	display: -webkit-box;
	overflow: hidden;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
}

</style></div><main class="main-wrapper"><div class="section-home-hero"><div class="page-padding"><div class="container-medium"><div class="home-hero_component"><div class="home-hero-top-wrapper"><div class="max-width-large text-align-center align-center"><h1 class="heading">Exchange vBELLS for BELLS Vaults</h1><div id="card-listings" class="listings-card"><div class="listings-list"><div class="margin-bottom margin-medium"><p class="text-color-grey">Select a Vault to exchange vBELLS for</p></div><div id="listings-cards-container" class="w-layout-grid listing-grid"><div id="samplestyle" class="sample-card hide w-node-_74847abd-671f-49fc-d672-ad7a46ca130f-821f9d80"><img src="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/66eb811a744e83ec3c8fa347_bell.png" loading="lazy" width="100" alt="A bag of bellscoin" class="image-2"/><h4 id="balance" class="h4">999 BEL</h4><h5 id="balance" class="h5">Heading</h5><h6 id="tokenID" class="h6">Heading</h6></div></div></div><a id="fetch-listings" href="javascript:void(0)" class="listings-button w-button">List Vaults</a><a id="btn-redeem" href="javascript:void(0)" class="redeem-button w-button">Redeem Vault</a></div><div id="card-done" class="done-card"><div class="vault-list"><div class="margin-bottom margin-medium"><p class="text-color-grey">BELLS Vault has been redeemed!</p><img src="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/670bd98aeccd37f1aa553a16_BEL%20LOGO.png" loading="lazy" width="150" height="150" alt="Bellscoin Logo" srcset="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/670bd98aeccd37f1aa553a16_BEL%20LOGO-p-500.png 500w, https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/670bd98aeccd37f1aa553a16_BEL%20LOGO.png 600w" sizes="100vw"/></div></div><a id="restart-btn" href="javascript:void(0)" aria-current="page" class="restart-button w-button w--current">Restart</a></div></div></div></div></div></div><div class="gradient-wrapper"><div data-w-id="2ba8ccfe-c724-0450-a88f-f9313b0018ac" style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="circle _1"></div><div data-w-id="2ba8ccfe-c724-0450-a88f-f9313b0018ad" style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="circle _2"></div><div data-w-id="2ba8ccfe-c724-0450-a88f-f9313b0018ae" style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="circle _4"></div><div data-w-id="2ba8ccfe-c724-0450-a88f-f9313b0018af" style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="circle _3"></div><div data-w-id="e1f076b2-b166-c6db-adf1-3ceefb6a858c" class="amazing-trigger"></div></div></div></main></div><script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66e67a4cc40e1bbd3ff60b7c" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://cdn.prod.website-files.com/66e67a4cc40e1bbd3ff60b7c/js/webflow.efdf08e11f4c84ed5a9e755f1e968f0f.js" type="text/javascript"></script><!-- Adding web3.js-->
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script><script src="https://unpkg.com/web3@latest/dist/web3.min.js"></script>
<script>
const web3 = new Web3(window.ethereum);

// Buttons
const walletButton = document.getElementById('btn-connect')
const listingsButton = document.getElementById('fetch-listings')
const redeemButton = document.getElementById('btn-redeem')

// Cards
const cardContainer = document.getElementById("listings-cards-container")
const gridCards = document.getElementById("grid-cards")
const cardDone = document.getElementById("card-done")

// Variables
let selectedAccount, selectedAddress, listingId, price

const vBELLSABI = [{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"book","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}]
const vBELLSAddress = '0x38FB3406532398Bc3ec391b5eBEB833cc4c89d58';
const vBELLSContract = new web3.eth.Contract(vBELLSABI, vBELLSAddress);

const exchangeABI =[
  {"inputs":[],"name":"totalListings","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_listingId","type":"uint256"},{"components":[{"internalType":"address","name":"assetContract","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"address","name":"currency","type":"address"},{"internalType":"uint256","name":"pricePerToken","type":"uint256"},{"internalType":"uint128","name":"startTimestamp","type":"uint128"},{"internalType":"uint128","name":"endTimestamp","type":"uint128"},{"internalType":"bool","name":"reserved","type":"bool"}],"internalType":"structIDirectListings.ListingParameters","name":"_params","type":"tuple"}],"name":"updateListing","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"_startId","type":"uint256"},{"internalType":"uint256","name":"_endId","type":"uint256"}],"name":"getAllValidListings","outputs":[{"components":[{"internalType":"uint256","name":"listingId","type":"uint256"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"pricePerToken","type":"uint256"},{"internalType":"uint128","name":"startTimestamp","type":"uint128"},{"internalType":"uint128","name":"endTimestamp","type":"uint128"},{"internalType":"address","name":"listingCreator","type":"address"},{"internalType":"address","name":"assetContract","type":"address"},{"internalType":"address","name":"currency","type":"address"},{"internalType":"enumIDirectListings.TokenType","name":"tokenType","type":"uint8"},{"internalType":"enumIDirectListings.Status","name":"status","type":"uint8"},{"internalType":"bool","name":"reserved","type":"bool"}],"internalType":"structIDirectListings.Listing[]","name":"_validListings","type":"tuple[]"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"_listingId","type":"uint256"},{"internalType":"address","name":"_buyFor","type":"address"},{"internalType":"uint256","name":"_quantity","type":"uint256"},{"internalType":"address","name":"_currency","type":"address"},{"internalType":"uint256","name":"_expectedTotalPrice","type":"uint256"}],"name":"buyFromListing","outputs":[],"stateMutability":"payable","type":"function"}
];
const exchangeAddress = '0x60a61d1180Bf6d58684052c64284721160A2e253';
const exchangeContract = new web3.eth.Contract(exchangeABI, exchangeAddress);

function toggleButton() {
  if (!window.ethereum) {
    loginButton.innerText = 'MetaMask is not installed'
    console.log("No wallet extension found")
	return false
  }

  walletButton.addEventListener('click', connectWallet)
}

async function connectWallet() {
  if (event && event.preventDefault) event.preventDefault();
  const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' })
	.catch((e) => {
	  console.error(e.message)
	  return
	})
  if (!accounts) { return }

  selectedAccount = window.ethereum.selectedAddress
  selectedAddress = web3.utils.toChecksumAddress(selectedAccount)
  var shortAccount = selectedAddress.replace(selectedAddress.substring(6,selectedAddress.length - 4), "...");
  listingsButton.style.backgroundColor = "orange";
  walletButton.innerText = shortAccount
  walletButton.href = "https://etherscan.io/address/" + selectedAddress
  walletButton.target = "_blank"
  walletButton.style.backgroundColor = "white";
  walletButton.style.opacity = 0.8;
  walletButton.removeEventListener('click', connectWallet)
  listingsButton.addEventListener('click', getListings)
}

window.addEventListener('DOMContentLoaded', () => {
    toggleButton()
});

async function getListings() {
  if (event && event.preventDefault) event.preventDefault();
  let listings = await exchangeContract.methods
  .totalListings()
  .call(); 
 
  let listingsCount = Number(listings)

  let validListings = await exchangeContract.methods
  .getAllValidListings(0, (listingsCount - 1))
  .call();
  
  let validListingsCount = Object.keys(validListings).length;
 
  cardContainer.style.display = "grid";

  for (var i = 0; i < (validListingsCount - 1); i++) {
  
    const style = document.getElementById('samplestyle')
    const card = style.cloneNode(true)

    card.setAttribute('id', 'grid-cards');
    card.style.display = 'block';
              
    card.addEventListener('click', function() {
        var elements = document.getElementsByClassName('sample-card');
        for (var j = 0; j < elements.length; j++) {
            elements[j].style.filter = "saturate(0)";
        }
        card.style.filter = "saturate(1)";
        price = (Number(h6.textContent) * 10**18)
        listingId = h5.textContent;
    });

    const img = card.getElementsByTagName('IMG')[0]
    img.src = "https://emblem.finance/bell.png";
              
    const h4 = card.getElementsByTagName('H4')[0]
    balance = Number(validListings[i].tokenId)
    h4.textContent = balance + ' ' + "BEL";
              
    const h5 = card.getElementsByTagName('H5')[0]
    h5.textContent = validListings[i].listingId;
              
    const h6 = card.getElementsByTagName('H6')[0]
    h6.textContent = validListings[i].tokenId;
              
    cardContainer.appendChild(card);
  }

  listingsButton.style.display = "none";
  redeemButton.style.display = "inline-block";
  redeemButton.addEventListener('click', redeemVault)
}

async function redeemVault() {
  if (event && event.preventDefault) event.preventDefault();
  //console.log(listingId + " " + selectedAddress + " " + 1 + " " + vBELLSAddress + " " + price + " " + 0)

  vBELLSContract.methods
  .approve(exchangeAddress, price)
  .send({ from: selectedAddress })
  .on('transactionHash', function(transactionHash) {
    console.log("Hash of the transaction: " + transactionHash)

    exchangeContract.methods
    .buyFromListing(listingId, selectedAddress, 1, vBELLSAddress, price, 0)
    .send({ from: selectedAddress })
    .on('transactionHash', function(transactionHash) {
        console.log("Hash of the transaction: " + transactionHash)

        cardDone.style.display = "block";
    })
  })
}
</script></body></html>